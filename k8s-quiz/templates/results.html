<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css', v=5) }}">
</head>
<body>
<div class="quiz-container wide">
    <h1 style="text-align: center;">Quiz Results</h1>

    <div class="congrats">
        Your Score: {{ score }} / {{ total }}
        {% if score >= (total * 0.7) %}
            – Congratulations, you qualified for a certificate!
        {% else %}
            – Keep practicing to earn the certificate.
        {% endif %}
    </div>

    {% if score >= (total * 0.7) %}
  <div class="cert-wrapper">
    <img
      id="certificate-img"
      class="cert-img"
      src="{{ url_for('certificate_image') }}?name={{ name|urlencode }}&date={{ date_str }}"
      alt="Certificate preview">
    <div class="actions">
      <a class="download-btn"
         href="{{ url_for('certificate_image') }}?name={{ name|urlencode }}&date={{ date_str }}&download=1">
         Download PNG
      </a>
      <a class="share-btn"
         href="{{ url_for('certificate_pdf') }}?name={{ name|urlencode }}&date={{ date_str }}">
         Download PDF
      </a>
    </div>
  </div>
{% endif %}

    {% if incorrect_answers %}
      <div class="answers">
        <h2>Incorrect Answers</h2>
        {% for ans in incorrect_answers %}
          <p>
            <strong>Question:</strong> {{ ans.question }}<br>
            <span>✅ Correct Answer: {{ ans.correct }}</span><br>
            <span>❌ Your Answer: {{ ans.yours }}</span>
          </p>
        {% endfor %}
      </div>
    {% endif %}

    <div class="actions" style="margin-top: 24px;">
        <a class="primary" href="{{ url_for('capture_name') }}">Try Again</a>
    </div>
</div>

<!-- html2canvas for image export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function downloadCertificate() {
  const certDiv = document.getElementById('certificate');
  html2canvas(certDiv, {scale: 2}).then(canvas => {
      const link = document.createElement('a');
      link.download = 'certificate.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
  });
}
</script>
</body>
</html>
